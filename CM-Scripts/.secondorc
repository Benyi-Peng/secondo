# SECONDO ENVIRONMENT CONFIGURATION
#
# Feb 2005. Markus Spiekermann
#
# The file ".secondorc" must be executed at startup of a bash.
# Copy this file into your $HOME directory and add the line 
#
#   source $HOME/.secondorc [Root of Secondo source files]
#
# at the end of file $HOME/.bashrc.
#
# Consult the files 
#
#    .secondo.win32rc 
# or .secondo.linuxrc
# or .secondo.sdkrc
# 
# for setting platform specific or general parameters.
#
# DO NOT CHANGE THIS FILE!

if [ "$OSTYPE" == "msys" ]; then
   prefix=/c
   platform="win32"
else 
   prefix=$HOME
   platform="linux"
fi

# define important base directories
buildDir=$HOME/secondo
if [ "$1" != "" ]; then
buildDir=$1
fi

# test if $buildDir seems to be a SECONDO source tree 
if ! [ -d ${buildDir}/Algebras/Standard-C++ ]; then
  printf "%s\n" "The directory ${buildDir} seems not to be a secondo source tree!"
  printf "%s\n" "Setting \$SECONDO_BUILD_DIR=\$HOME/secondo."
  buildDir=${HOME}/secondo
fi

# define a directory for the secondo development tools
sdkDir=${prefix}/secondo-sdk
if [ "$SECONDO_SDK" != "" ]; then
sdkDir=$SECONDO_SDK
fi

ok="true"
if ! [ -d $buildDir ]; then
  printf "%s"   "Error: I assume the SECONDO sources are in \"${buildDir}\" but this "
  printf "%s\n" "directory is not present!"
  ok="false" 
fi

if ! [ -d $sdkDir ]; then
  printf "%s"   "Error: I assume the SECONDO development tools are in \"${sdkDir}\" "
  printf "%s\n" "but this directory is not present!"
  ok="false" 
fi

if [ "$ok" == "true" ]; then

# export variables to the environment which are
# evaluated by make
export SECONDO_SDK=$sdkDir
export SECONDO_BUILD_DIR=$buildDir
export SECONDO_PLATFORM=$platform

# include platform specific definitions
source ${HOME}/.secondo.${platform}rc

# include command aliases
source ${sdkDir}/bin/aliaslist.sh

# include common definitions
source ${HOME}/.secondo.sdkrc

# set common variables
source ${sdkDir}/bin/setvar.bash ${buildDir}

# Berkeley-DB Library
#
# In windows installations of SECONDO-SDK the library has another
# name as in the Berkeley-DB distribution, since the --enable-mingw
# configure option was not present in version 4.1.25.
BERKELEY_DB_LIB="db_cxx"

if [ $SECONDO_PLATFORM == "win32" ]; then
  if [ -f ${BERKELEY_DB_DIR}/lib/libdb32.dll ]; then
     BERKELEY_DB_LIB="db32"
  fi
fi
export BERKELEY_DB_LIB

# Check if important directories are present
declare -i DIR_ERROR=0
if ! [ -d $BERKELEY_DB_DIR ]; then
  printf "%s"   "Error during SECONDO environment setup: Berkeley-DB "
  printf "%s\n"  "directory \"${BERKELEY_DB_DIR}\" not present!"
  let DIR_ERROR++ 
fi

if ! [ -d $J2SDK_ROOT ]; then
  printf "%s"   "Error during SECONDO environment setup: Java 2 SDK "
  printf "%s\n" "directory \"${J2SDK_ROOT}\" not present!"
  let DIR_ERROR++
fi

if ! [ -d $PL_LIB_DIR ]; then
  printf "%s"   "Error during SECONDO environment setup: SWI-Prolog library "
  printf "%s"   "directory \"${$PL_LIB_DIR}\" not present! Please "
  let DIR_Error++
fi

if let $DIR_ERROR!=0; then
  printf "%s"   "Please check your installation and consult the "
  printf "%s\n" "files ~/.secondo.sdkrc and ~/.secondo.${platform}rc "
fi

# end of "$ok"="true"
fi

catvar 
printf "\n%s\n"  "In case of trouble consult the environment setup files:"
printf "%s\n"    "  ${HOME}/.secondo.sdkrc"
printf "%s\n"    "  ${HOME}/.secondo.${platform}rc"
printf "%s\n"    "  ${HOME}/.secondorc"
printf "%s\n\n"  "  ${sdkDir}/bin/setvar.bash"
