#!/bin/bash


if [ -n "$1"  ]; then
   REV=" -r $1 "
   VERSION=$1
else
   REV=" -D now "
   VERSION=current
fi

if [ -d secondo ] ; then
  echo "directory secondo exists"
  exit 1
fi


cvs export $REV  secondo

if [ $? != "0" ] ; then
  echo "problems with cvs export"
  exit 1
fi

secondo/CM-Scripts/mkpublic.sh secondo/nonpublic.filelist publicsecondo_filelist


if [ -f "secpub.tar" ] ; then
  echo secpub.tar exists
  exit 1
fi

if [ "$SECONDO_PLATFORM" = "win32" ]; then
  cat publicsecondo_filelist | sed "s/.*/zip -rf secondo-$VERSION-CP1252.zip \"&\"/g" | sh
else
  cat publicsecondo_filelist | sed "s/.*/tar -rf secondo-$VERSION-LAT1.tar \"&\"/g" | sh
  gzip secondo-$VERSION-LAT1.tar
fi

echo "archive created"

rm -r secondo




