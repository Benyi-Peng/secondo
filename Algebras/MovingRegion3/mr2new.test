###############################################################################

create database mr2newtestDB;
open database mr2newtestDB;

###############################################################################

let mr2 = [const mregion2 value (3 (((0 10 TRUE TRUE ())
					((((10 35 15 15 ())
					   (20 55 30 45 ())
					   (30 65 35 50 ())
					   (40 65 55 50 ())
					   (40 55 55 45 ())
					   (50 45 75 25 ())
					   (50 25 75 10 ())
					   (40 15 70  5 ())
					   (30 15 25  5 ()))
					  ((20 30 30 20 ())
					   (20 40 30 30 ())
					   (30 40 40 30 ())
					   (30 30 40 20 ())))))))]

let ur2 = [const uregion2 value (1 ((0 10 TRUE TRUE ())
					((((10 35 15 15 ())
					   (20 55 30 45 ())
					   (30 65 35 50 ())
					   (40 65 55 50 ())
					   (40 55 55 45 ())
					   (50 45 75 25 ())
					   (50 25 75 10 ())
					   (40 15 70  5 ())
					   (30 15 25  5 ()))
					  ((20 30 30 20 ())
					   (20 40 30 30 ())
					   (30 40 40 30 ())
					   (30 30 40 20 ()))))))]

let mr = [const mregion value (((0.0 10.0 TRUE TRUE)
				   ((((1.0 3.5 1.5 1.5)
				      (2.0 5.5 3.0 4.5)
				      (3.0 6.5 3.5 5.0)
				      (4.0 6.5 5.5 5.0)
				      (4.0 5.5 5.5 4.5)
				      (5.0 4.5 7.5 2.5)
				      (5.0 2.5 7.5 1.0)
				      (4.0 1.5 7.0 0.5)
				      (3.0 1.5 2.5 0.5))
				     ((2.0 3.0 3.0 2.0)
				      (2.0 4.0 3.0 3.0)
				      (3.0 4.0 4.0 3.0)
				      (3.0 3.0 4.0 2.0))))))]

let ur = [const uregion value ((0.0 10.0 TRUE TRUE)
				   ((((1.0 3.5 1.5 1.5)
				      (2.0 5.5 3.0 4.5)
				      (3.0 6.5 3.5 5.0)
				      (4.0 6.5 5.5 5.0)
				      (4.0 5.5 5.5 4.5)
				      (5.0 4.5 7.5 2.5)
				      (5.0 2.5 7.5 1.0)
				      (4.0 1.5 7.0 0.5)
				      (3.0 1.5 2.5 0.5))
				     ((2.0 3.0 3.0 2.0)
				      (2.0 4.0 3.0 3.0)
				      (3.0 4.0 4.0 3.0)
				      (3.0 3.0 4.0 2.0)))))]

let mrex = [const mregion value (((0.0 10.0 TRUE TRUE)
				 ((((1.5 1.5 3.5 3.5)
				    (4.0 4.0 6.5 6.5)
				    (7.5 7.5 5.0 5.0))))))]

let mr2ex = [const mregion2 value (2 ((("2012-01-13-14:30:00" "2012-01-13-19:15:00" TRUE TRUE ())
				      ((((15 15 35 35 ())
					 (40 40 65 65 ())
					 (75 75 50 50 ())))))))]

let mp = [const mpoint value (((0 10 TRUE TRUE)(0.01 0.015 0.075 0.05)))]

###############################################################################

#testcase "1 - scale2"
#yields (mregion2 (3 ((("2000-01-03" "2000-01-13" TRUE TRUE ()) ((((10 35 15 15 ()) (20 55 30 45 ()) (30 65 35 50 ()) (40 65 55 50 ()) (40 55 55 45 ()) (50 45 75 25 ()) (50 25 75 10 ()) (40 15 70 5 ()) (30 15 25 5 ())) ((20 30 30 20 ()) (20 40 30 30 ()) (30 40 40 30 ()) (30 30 40 20 ()))))))))
query mr2 scale2[1.0, 1.0];

#testcase "2 - scale2"
#yields (mregion2 (3 ((("2000-01-03" "2000-01-13" TRUE TRUE ()) ((((10000 35000 15000 15000 ()) (20000 55000 30000 45000 ()) (30000 65000 35000 50000 ()) (40000 65000 55000 50000 ()) (40000 55000 55000 45000 ()) (50000 45000 75000 25000 ()) (50000 25000 75000 10000 ()) (40000 15000 70000 5000 ()) (30000 15000 25000 5000 ())) ((20000 30000 30000 20000 ()) (20000 40000 30000 30000 ()) (30000 40000 40000 30000 ()) (30000 30000 40000 20000 ()))))))))
query mr2 scale2[1000.0, 1000.0];

#testcase "3 - scale2"
#yields (mregion2 (3 ((("2000-01-03" "2000-01-13" TRUE TRUE ()) ((((5 3 7 1 ('0' '1/2' '1/2' '1/2')) (10 5 15 4 ('0' '1/2' '0' '1/2')) (15 6 17 5 ('0' '1/2' '1/2' '0')) (20 6 27 5 ('0' '1/2' '1/2' '0')) (20 5 27 4 ('0' '1/2' '1/2' '1/2')) (25 4 37 2 ('0' '1/2' '1/2' '1/2')) (25 2 37 1 ('0' '1/2' '1/2' '0')) (20 1 35 0 ('0' '1/2' '0' '1/2')) (15 1 12 0 ('0' '1/2' '1/2' '1/2'))) ((10 3 15 2 ()) (10 4 15 3 ()) (15 4 20 3 ()) (15 3 20 2 ()))))))))
query mr2 scale2[0.5, 0.1];

#testcase "4 - scale2"
#yields (mregion2 (3 ((("2000-01-03" "2000-01-13" TRUE TRUE ()) ((((0 0 0 0 ('1/1000' '7/2000' '3/2000' '3/2000')) (0 0 0 0 ('1/500' '11/2000' '3/1000' '9/2000')) (0 0 0 0 ('3/1000' '13/2000' '7/2000' '1/200')) (0 0 0 0 ('1/250' '13/2000' '11/2000' '1/200')) (0 0 0 0 ('1/250' '11/2000' '11/2000' '9/2000')) (0 0 0 0 ('1/200' '9/2000' '3/400' '1/400')) (0 0 0 0 ('1/200' '1/400' '3/400' '1/1000')) (0 0 0 0 ('1/250' '3/2000' '7/1000' '1/2000')) (0 0 0 0 ('3/1000' '3/2000' '1/400' '1/2000'))) ((0 0 0 0 ('1/500' '3/1000' '3/1000' '1/500')) (0 0 0 0 ('1/500' '1/250' '3/1000' '3/1000')) (0 0 0 0 ('3/1000' '1/250' '1/250' '3/1000')) (0 0 0 0 ('3/1000' '3/1000' '1/250' '1/500')))))))))
query mr2 scale2[0.0001, 0.0001];

#testcase "5 - mra2transform"
#yields (mregion2 (3 ((("2000-01-03" "2000-01-13" TRUE TRUE ()) ((((10 40 15 20 ()) (20 60 30 50 ()) (30 70 35 55 ()) (40 70 55 55 ()) (40 60 55 50 ()) (50 50 75 30 ()) (50 30 75 15 ()) (40 20 70 10 ()) (30 20 25 10 ())) ((20 35 30 25 ()) (20 45 30 35 ()) (30 45 40 35 ()) (30 35 40 25 ()))))))))
query mra2transform(mr2, 0.0, 5.0);

#testcase "5 - mra2transform"
#yields (mregion2 (3 ((("2000-01-03" "2000-01-13" TRUE TRUE ()) ((((10 35 15 15 ('1/4' '7/10' '1/4' '7/10')) (20 55 30 45 ('1/4' '7/10' '1/4' '7/10')) (30 65 35 50 ('1/4' '7/10' '1/4' '7/10')) (40 65 55 50 ('1/4' '7/10' '1/4' '7/10')) (40 55 55 45 ('1/4' '7/10' '1/4' '7/10')) (50 45 75 25 ('1/4' '7/10' '1/4' '7/10')) (50 25 75 10 ('1/4' '7/10' '1/4' '7/10')) (40 15 70 5 ('1/4' '7/10' '1/4' '7/10')) (30 15 25 5 ('1/4' '7/10' '1/4' '7/10'))) ((20 30 30 20 ('1/4' '7/10' '1/4' '7/10')) (20 40 30 30 ('1/4' '7/10' '1/4' '7/10')) (30 40 40 30 ('1/4' '7/10' '1/4' '7/10')) (30 30 40 20 ('1/4' '7/10' '1/4' '7/10')))))))))
query mra2transform(mr2,  0.25, 0.7);

#testcase "5 - mra2transform"
#yields (mregion2 (3 ((("2000-01-03" "2000-01-13" TRUE TRUE ()) ((((10 35 15 15 ('1/10000' '1/2000' '1/10000' '1/2000')) (20 55 30 45 ('1/10000' '1/2000' '1/10000' '1/2000')) (30 65 35 50 ('1/10000' '1/2000' '1/10000' '1/2000')) (40 65 55 50 ('1/10000' '1/2000' '1/10000' '1/2000')) (40 55 55 45 ('1/10000' '1/2000' '1/10000' '1/2000')) (50 45 75 25 ('1/10000' '1/2000' '1/10000' '1/2000')) (50 25 75 10 ('1/10000' '1/2000' '1/10000' '1/2000')) (40 15 70 5 ('1/10000' '1/2000' '1/10000' '1/2000')) (30 15 25 5 ('1/10000' '1/2000' '1/10000' '1/2000'))) ((20 30 30 20 ('1/10000' '1/2000' '1/10000' '1/2000')) (20 40 30 30 ('1/10000' '1/2000' '1/10000' '1/2000')) (30 40 40 30 ('1/10000' '1/2000' '1/10000' '1/2000')) (30 30 40 20 ('1/10000' '1/2000' '1/10000' '1/2000')))))))))
query mra2transform(mr2, 0.0001, 0.0005);

#testcase "8 - mregiontomregion2"
#yields (mregion2 (2 ((("2000-01-03" "2000-01-13" TRUE TRUE ()) ((((100 350 150 150 ()) (200 550 300 450 ()) (300 650 350 500 ()) (400 650 550 500 ()) (400 550 550 450 ()) (500 450 750 250 ()) (500 250 750 100 ()) (400 150 700 50 ()) (300 150 250 50 ())) ((200 300 300 200 ()) (200 400 300 300 ()) (300 400 400 300 ()) (300 300 400 200 ()))))))))
query mregiontomregion2(mr, 2);

#testcase "9 - mregiontomregion2"
#yields  (mregion2 (0 ((("2000-01-03" "2000-01-13" TRUE TRUE ()) ((((1 3 1 1 ('0' '1/2' '1/2' '1/2')) (2 5 3 4 ('0' '1/2' '0' '1/2')) (3 6 3 5 ('0' '1/2' '1/2' '0')) (4 6 5 5 ('0' '1/2' '1/2' '0')) (4 5 5 4 ('0' '1/2' '1/2' '1/2')) (5 4 7 2 ('0' '1/2' '1/2' '1/2')) (5 2 7 1 ('0' '1/2' '1/2' '0')) (4 1 7 0 ('0' '1/2' '0' '1/2')) (3 1 2 0 ('0' '1/2' '1/2' '1/2'))) ((2 3 3 2 ()) (2 4 3 3 ()) (3 4 4 3 ()) (3 3 4 2 ()))))))))
query mregiontomregion2(mr, 0);

#testcase "10 - mregiontomregion2"
#yields (mregion2 (4 ((("2000-01-03" "2000-01-13" TRUE TRUE ()) ((((10000 35000 15000 15000 ()) (20000 55000 30000 45000 ()) (30000 65000 35000 50000 ()) (40000 65000 55000 50000 ()) (40000 55000 55000 45000 ()) (50000 45000 75000 25000 ()) (50000 25000 75000 10000 ()) (40000 15000 70000 5000 ()) (30000 15000 25000 5000 ())) ((20000 30000 30000 20000 ()) (20000 40000 30000 30000 ()) (30000 40000 40000 30000 ()) (30000 30000 40000 20000 ()))))))))
query mregiontomregion2(mr, 4);

#testcase "11 - uregiontouregion2"
#yields (uregion2 (6 (("2000-01-03" "2000-01-13" TRUE TRUE ()) ((((1000000 3500000 1500000 1500000 ()) (2000000 5500000 3000000 4500000 ()) (3000000 6500000 3500000 5000000 ()) (4000000 6500000 5500000 5000000 ()) (4000000 5500000 5500000 4500000 ()) (5000000 4500000 7500000 2500000 ()) (5000000 2500000 7500000 1000000 ()) (4000000 1500000 7000000 500000 ()) (3000000 1500000 2500000 500000 ())) ((2000000 3000000 3000000 2000000 ()) (2000000 4000000 3000000 3000000 ()) (3000000 4000000 4000000 3000000 ()) (3000000 3000000 4000000 2000000 ())))))))
query uregiontouregion2(ur, 6);

#testcase "12 - uregiontouregion2"
#yields (uregion2 (0 (("2000-01-03" "2000-01-13" TRUE TRUE ()) ((((1 3 1 1 ('0' '1/2' '1/2' '1/2')) (2 5 3 4 ('0' '1/2' '0' '1/2')) (3 6 3 5 ('0' '1/2' '1/2' '0')) (4 6 5 5 ('0' '1/2' '1/2' '0')) (4 5 5 4 ('0' '1/2' '1/2' '1/2')) (5 4 7 2 ('0' '1/2' '1/2' '1/2')) (5 2 7 1 ('0' '1/2' '1/2' '0')) (4 1 7 0 ('0' '1/2' '0' '1/2')) (3 1 2 0 ('0' '1/2' '1/2' '1/2'))) ((2 3 3 2 ()) (2 4 3 3 ()) (3 4 4 3 ()) (3 3 4 2 ())))))))
query uregiontouregion2(ur, 0);

#testcase "13 - uregiontouregion2"
#yields (uregion2 (3 (("2000-01-03" "2000-01-13" TRUE TRUE ()) ((((1000 3500 1500 1500 ()) (2000 5500 3000 4500 ()) (3000 6500 3500 5000 ()) (4000 6500 5500 5000 ()) (4000 5500 5500 4500 ()) (5000 4500 7500 2500 ()) (5000 2500 7500 1000 ()) (4000 1500 7000 500 ()) (3000 1500 2500 500 ())) ((2000 3000 3000 2000 ()) (2000 4000 3000 3000 ()) (3000 4000 4000 3000 ()) (3000 3000 4000 2000 ())))))))
query uregiontouregion2(ur, 3);

#testcase "14 - atinstant uregion2"
#yields (iregion2 ("2000-01-05" (1 ((((29 13 ()) (11 31 ()) (22 53 ()) (31 62 ()) (43 62 ()) (43 53 ()) (55 41 ()) (55 22 ()) (46 13 ())) ((32 28 ()) (22 28 ()) (22 38 ()) (32 38 ())))))))
query ur2 atinstant [const instant value "2000-01-05"];

#testcase "15 - atinstant mregion2"
#yields (iregion2 ("2000-01-08-17:45:30" (3 ((((27 9 ('292812163272613/2251799813685248' '292812163272613/1125899906842624')) (12 23 ('1958987650412635/2251799813685248' '292812163272613/562949953421312')) (25 49 ('833087743570011/1125899906842624' '292812163272613/1125899906842624')) (32 56 ('1958987650412635/2251799813685248' '878436489817839/2251799813685248')) (48 56 ('1373363323867409/2251799813685248' '878436489817839/2251799813685248')) (48 49 ('1373363323867409/2251799813685248' '292812163272613/1125899906842624')) (64 33 ('787738997322183/2251799813685248' '292812163272613/562949953421312')) (64 16 ('787738997322183/2251799813685248' '878436489817839/2251799813685248')) (57 9 ('247463417024785/1125899906842624' '292812163272613/1125899906842624'))) ((35 24 ('833087743570011/1125899906842624' '292812163272613/1125899906842624')) (25 24 ('833087743570011/1125899906842624' '292812163272613/1125899906842624')) (25 34 ('833087743570011/1125899906842624' '292812163272613/1125899906842624')) (35 34 ('833087743570011/1125899906842624' '292812163272613/1125899906842624'))))))))
query mr2 atinstant [const instant value "2000-01-08-17:45:30"];

#testcase "16 - initial"
#yields (iregion2 ("2000-01-03" (3 ((((30 15 ()) (10 35 ()) (20 55 ()) (30 65 ()) (40 65 ()) (40 55 ()) (50 45 ()) (50 25 ()) (40 15 ())) ((30 30 ()) (20 30 ()) (20 40 ()) (30 40 ())))))))
query initial(mr2);

#testcase "17 - final"
#yields (iregion2 ("2000-01-13" (3 ((((25 5 ()) (15 15 ()) (30 45 ()) (35 50 ()) (55 50 ()) (55 45 ()) (75 25 ()) (75 10 ()) (70 5 ())) ((40 20 ()) (30 20 ()) (30 30 ()) (40 30 ())))))))
query final(mr2);

#testcase "18 - inst"
#yields (instant "2000-01-03")
query inst(initial(mr2));

#testcase "19 - val"
#yields (region2 (3 ((((30 15 ()) (10 35 ()) (20 55 ()) (30 65 ()) (40 65 ()) (40 55 ()) (50 45 ()) (50 25 ()) (40 15 ())) ((30 30 ()) (20 30 ()) (20 40 ()) (30 40 ()))))))
query val(initial(mr2));

#testcase "20 - setscalefactor uregion2"
#yields (uregion2 (3 (("2000-01-03" "2000-01-13" TRUE TRUE ()) ((((1000 3500 1500 1500 ()) (2000 5500 3000 4500 ()) (3000 6500 3500 5000 ()) (4000 6500 5500 5000 ()) (4000 5500 5500 4500 ()) (5000 4500 7500 2500 ()) (5000 2500 7500 1000 ()) (4000 1500 7000 500 ()) (3000 1500 2500 500 ())) ((2000 3000 3000 2000 ()) (2000 4000 3000 3000 ()) (3000 4000 4000 3000 ()) (3000 3000 4000 2000 ())))))))
query setscalefactor(ur2, 3);

#testcase "21 - setscalefactor mregion2"
#yields (mregion2 (1 ((("2000-01-03" "2000-01-13" TRUE TRUE ()) ((((0 0 0 0 ('1/10' '7/20' '3/20' '3/20')) (0 0 0 0 ('1/5' '11/20' '3/10' '9/20')) (0 0 0 0 ('3/10' '13/20' '7/20' '1/2')) (0 0 0 0 ('2/5' '13/20' '11/20' '1/2')) (0 0 0 0 ('2/5' '11/20' '11/20' '9/20')) (0 0 0 0 ('1/2' '9/20' '3/4' '1/4')) (0 0 0 0 ('1/2' '1/4' '3/4' '1/10')) (0 0 0 0 ('2/5' '3/20' '7/10' '1/20')) (0 0 0 0 ('3/10' '3/20' '1/4' '1/20'))) ((0 0 0 0 ('1/5' '3/10' '3/10' '1/5')) (0 0 0 0 ('1/5' '2/5' '3/10' '3/10')) (0 0 0 0 ('3/10' '2/5' '2/5' '3/10')) (0 0 0 0 ('3/10' '3/10' '2/5' '1/5')))))))))
query setscalefactor(mr2, 1);

#tolerance_real %0.1
#testcase "22 - intersection"
#yields (mpoint ((("2000-01-04-17:44:20.870" "2000-01-06-08:00" TRUE TRUE) (0.02130434782608695 0.02108695652173913 0.03166666666666666 0.02666666666666666)) (("2000-01-06-15:16:21.818" "2000-01-10-08:50:31.579" TRUE TRUE) (0.03363636363636363 0.02772727272727273 0.05789473684210526 0.04078947368421053))))
query intersection(mp, mr2);

#testcase "23 - inside"
#yields (mbool ((("2000-01-03" "2000-01-04-17:44:20.870" TRUE FALSE) FALSE) (("2000-01-04-17:44:20.870" "2000-01-06-08:00" TRUE TRUE) TRUE) (("2000-01-06-08:00" "2000-01-06-15:16:21.818" FALSE FALSE) FALSE) (("2000-01-06-15:16:21.818" "2000-01-10-08:50:31.579" TRUE TRUE) TRUE) (("2000-01-10-08:50:31.579" "2000-01-13" FALSE TRUE) FALSE)))
query mp inside mr2;

#testcase "24 - traversed mregion2"
#yields (region2 (3 ((((15 15 ()) (10 35 ()) (20 55 ()) (30 65 ()) (40 65 ()) (55 50 ()) (55 45 ()) (75 25 ()) (75 10 ()) (70 5 ()) (25 5 ()))))))
query traversed(mr2);

#testcase "25 - scale"
#yields (mregion2 (3 ((("2000-01-03" "2000-01-13" TRUE TRUE ()) ((((10 35 15 15 ()) (20 55 30 45 ()) (30 65 35 50 ()) (40 65 55 50 ()) (40 55 55 45 ()) (50 45 75 25 ()) (50 25 75 10 ()) (40 15 70 5 ()) (30 15 25 5 ())) ((20 30 30 20 ()) (20 40 30 30 ()) (30 40 40 30 ()) (30 30 40 20 ()))))))))
query mr2 scale[1.0];

#testcase "26 - scale"
#yields (mregion2 (3 ((("2000-01-03" "2000-01-13" TRUE TRUE ()) ((((10000 35000 15000 15000 ()) (20000 55000 30000 45000 ()) (30000 65000 35000 50000 ()) (40000 65000 55000 50000 ()) (40000 55000 55000 45000 ()) (50000 45000 75000 25000 ()) (50000 25000 75000 10000 ()) (40000 15000 70000 5000 ()) (30000 15000 25000 5000 ())) ((20000 30000 30000 20000 ()) (20000 40000 30000 30000 ()) (30000 40000 40000 30000 ()) (30000 30000 40000 20000 ()))))))))
query mr2 scale[1000.0];

#testcase "27 - scale"
#yields (mregion2 (3 ((("2000-01-03" "2000-01-13" TRUE TRUE ()) ((((0 0 0 0 ('1/1000' '7/2000' '3/2000' '3/2000')) (0 0 0 0 ('1/500' '11/2000' '3/1000' '9/2000')) (0 0 0 0 ('3/1000' '13/2000' '7/2000' '1/200')) (0 0 0 0 ('1/250' '13/2000' '11/2000' '1/200')) (0 0 0 0 ('1/250' '11/2000' '11/2000' '9/2000')) (0 0 0 0 ('1/200' '9/2000' '3/400' '1/400')) (0 0 0 0 ('1/200' '1/400' '3/400' '1/1000')) (0 0 0 0 ('1/250' '3/2000' '7/1000' '1/2000')) (0 0 0 0 ('3/1000' '3/2000' '1/400' '1/2000'))) ((0 0 0 0 ('1/500' '3/1000' '3/1000' '1/500')) (0 0 0 0 ('1/500' '1/250' '3/1000' '3/1000')) (0 0 0 0 ('3/1000' '1/250' '1/250' '3/1000')) (0 0 0 0 ('3/1000' '3/1000' '1/250' '1/500')))))))))
query mr2 scale[0.0001];


###############################################################################

#teardown
close database;
delete database mr2newtestDB;
