\section*{Appendix: Example Queries}
\label{sec:appendex}

\begin{itemize}

\item \textbf{Query} 16. Is \textit{Alexander} street near to the city center area?  \\

 We define \texttt{near} by the value of the distance being smaller than 200 meters. \\

$\hspace{1cm}$ \texttt{SELECT *}

$\hspace{1cm}$ \texttt{FROM \textbf{get\_rn}(SpaceHagen) as rn, \textbf{get\_rbo}(SpaceHagen) as rbo}

$\hspace{1cm}$ \texttt{WHERE rn.Name = ``Alexander"} $\wedge$  \texttt{rbo.Name = ``CityCenter''}

$\hspace{2.1cm}$ \texttt{\textbf{distance}(rn.Road,  rbo.Reg)} $<$ \texttt{200} \\

\end{itemize}



\begin{itemize}
 \item \textbf{Query} 17. Who was on bus 527 at six-thirty? \\

\texttt{LET qt = instant(2010, 12, 5, 18, 30)}  \\

\texttt{Let MBus527 =}

$\hspace{1cm}$ \texttt{SELECT *}

$\hspace{1cm}$ \texttt{FROM \textbf{get\_ptn}(SpaceHagen) as mbus}

$\hspace{1cm}$ \texttt{WHERE mbus.Name = ``Bus527''} \\


$\hspace{1cm}$ \texttt{SELECT mo.Name}

$\hspace{1cm}$ \texttt{FROM MOHagen as mo, MBus527 as mbus}

$\hspace{1cm}$ \texttt{WHERE \textbf{ref\_id}(\textbf{val}(\textbf{atinstant}(mo.Traj, qt))) = mbus.Mp\_id}  \\

\end{itemize}


\begin{itemize}
 \item \textbf{Query} 18. find all people walking through zone $A$.\\

\texttt{LET A\_Id = ELEM(}

$\hspace{1cm}$ \texttt{SELECT rbo.Poly\_id}

$\hspace{1cm}$ \texttt{FROM \textbf{get\_rbo}(SpaceHagen) as rbo}

$\hspace{1cm}$ \texttt{WHERE rbo.Name = ``Zone-A''}) \\

\texttt{LET IO\_A = genloc(A\_Id, ($\bot$, $\bot$))} \\

$\hspace{1cm}$ \texttt{SELECT mo.Name}

$\hspace{1cm}$ \texttt{FROM MOHagen as mo}

$\hspace{1cm}$ \texttt{WHERE \textbf{passes}(mo.Traj, IO\_A, SpaceHagen)} $\wedge$ 

$\hspace{2.2cm}$ \texttt{\textbf{contain}(\textbf{get\_mode}(mo.Traj), Walk)} \\

\end{itemize}


\begin{itemize}
 \item \textbf{Query} 19. Where did \textit{Bobby} transfer the bus? \\

$\hspace{1cm}$ \texttt{SELECT \textbf{val}(\textbf{initial}(\textbf{decompose}(\textbf{at}(mo.Traj, Bus))))}

$\hspace{1cm}$ \texttt{FROM MOHagen as mo}

$\hspace{1cm}$ \texttt{WHERE mo.Name = ``Bobby''} \\
\end{itemize}

The bus transfer has two possibilities: (1) \textit{Bobby} gets off the bus, stays at the bus stop and then takes another bus; (2) \textit{Bobby} gets off the bus, walks for a short distance and takes another bus. To represent the two cases, we define the place for transfer in a simplified way that the result is the place where \textit{Bobby} gets on the bus. In the query expression, we first restrict the movement with the mode $Bus$ and then decompose the moving object into a set of values each of which represents a bus that \textit{Bobby} takes. For each value, \textbf{initial} returns the  location with the start time and \textbf{val} gets the location. \\  


\begin{itemize}
 \item \textbf{Query} 20. Where was bus 527 at six-thirty? \\

\texttt{LET qt = instant(2010, 12, 5, 18, 30)} \\

$\hspace{1cm}$ \texttt{SELECT \textbf{val}(\textbf{at}(mbus.Vehicle, qt))}

$\hspace{1cm}$ \texttt{FROM \textbf{get\_ptn}(SpaceHagen) as mbus}

$\hspace{1cm}$ \texttt{WHERE mbus.Name = ``Bus527"} \\

\end{itemize}

\begin{itemize}
 \item \textbf{Query} 21. At which bus stops one can switch from line F to line J? \\

$\hspace{1cm}$ \texttt{SELECT bs1}

$\hspace{1cm}$ \texttt{FROM \textbf{get\_bs}(SpaceHagen) as bs1, \textbf{get\_bs}(SpaceHagen) as bs2},

$\hspace{2.1cm}$ \texttt{\textbf{get\_br}(SpaceHagen) as br1, \textbf{get\_br}(SpaceHagen) as br2}

$\hspace{1cm}$ \texttt{WHERE br1.Name = ``LineF''} $\wedge$ \texttt{br2.Name = ``LineJ''} $\wedge$ 

$\hspace{2.3cm}$ \texttt{bs1.Bs\_id = br1.Br\_id} $\wedge$ \texttt{bs2.Bs\_id = br2.Br\_id} $\wedge$ 

$\hspace{2.3cm}$ \texttt{\textbf{geo\_data}(bs1.Stop, br1.Route) = \textbf{geo\_data}(bs2.Stop, br2.Route)} \\

\end{itemize}


\begin{itemize}
 \item \textbf{Query} 22. Who was in office H04 of FernUniversity at 5 pm?\\

\texttt{LET qt = instant(2010, 12, 5, 17)}   \\

\texttt{LET room\_id = ELEM(}

$\hspace{1cm}$ \texttt{SELECT ind.In\_id}

$\hspace{1cm}$ \texttt{FROM \textbf{get\_indoor}(SpaceHagen) as ind}

$\hspace{1cm}$ \texttt{WHERE ind.Name = ``FernUni-H04''}) \\


$\hspace{1cm}$ \texttt{SELECT mo.Name}

$\hspace{1cm}$ \texttt{FROM MOHagen as mo}

$\hspace{1cm}$ \texttt{WHERE \textbf{ref\_id}(\textbf{val}(\textbf{atinstant}(mo.Traj, qt))) = room\_id}  \\

\end{itemize}

\begin{itemize}
 \item \textbf{Query} 23. What was the average waiting time at the traffic light at University street 1 on Nov. 15? \\

First, we get the street $id$ by the name. \\

\texttt{LET s\_id = ELEM(}

$\hspace{1cm}$ \texttt{SELECT rn.R\_id}

$\hspace{1cm}$ \texttt{FROM \textbf{get\_rn}(SpaceHagen) as rn}

$\hspace{1cm}$ \texttt{WHERE rn.Name = ``University Street 1''}) \\

\end{itemize}

Second, we create a $\underline{genloc}$ object denoting the position of the traffic light 
represented by $tl\_loc$ ($s\_id$, ($pos$, $\bot$)) where $pos$ records the relative position on that street. Let \textbf{avg} be the aggregate function returning the average value and we can formulate the query as below. \\

$\hspace{1cm}$ \texttt{SELECT AGGR(\textbf{avg}, \textbf{duration}(\textbf{deftime}(\textbf{at}(mo.traj, tl\_loc))))}

$\hspace{1cm}$ \texttt{FROM MOHagen as mo} \\


\begin{itemize}
 \item \textbf{Query} 24. Does anyone take a bicyle on a trip but also walk for more than ten minutes? \\

$\hspace{1cm}$ \texttt{SELECT mo.Name}

$\hspace{1cm}$ \texttt{FROM MOHagen as mo}

$\hspace{1cm}$ \texttt{WHERE \textbf{contain}(\textbf{get\_mode}(mo.Traj), Bicycle)} $\wedge$ 

$\hspace{2.2cm}$ \texttt{\textbf{contain}(\textbf{get\_mode}(mo.Traj), Walk)} $\wedge$ 

$\hspace{2.2cm}$ \texttt{\textbf{duration}(\textbf{deftime}(\textbf{at}(mo.Traj, Walk)))} $>$ \texttt{10} \\

\end{itemize}



\begin{itemize}
 \item \textbf{Query} 25. Find all travellers that their trips include more than three transportation modes. \\

$\hspace{1cm}$ \texttt{SELECT mo.Name}

$\hspace{1cm}$ \texttt{FROM MOHagen as mo}

$\hspace{1cm}$ \texttt{WHERE \textbf{no\_of\_components}(\textbf{get\_mode}(mo.Traj))} $>$ \texttt{3}

\end{itemize}
