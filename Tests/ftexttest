# a test for the ftext algebra
# run with : Runner -c MyConfig.config < ftexttest
# (Runner can be found in directory UserInterfaces)

# clean up what may be left over from e.g. a segfault
delete database ftexttest;

#setup
create database ftexttest;
open database ftexttest;
e

(create textrel1 : (rel(tuple((no int)(t text)))));
(update textrel1 := ((rel(tuple((no int)(t text))))
(
  (1 <text>Victor Teixeira de Almeida</text--->)
  (2 <file>SecondoConfig.ini</file--->)
)));

(create textrel2 : (rel(tuple((no int)(s string)))));
(update textrel2 := ((rel(tuple((no int)(s string))))
(
  (1 "Victor")
  (2 "nothing")
  (3 "T1TZWN")
)));

#testcase Filter1
#yields ((rel(tuple((no int))))((1)))
query textrel1 feed filter[.t contains "Victor"] project[no] consume;

#testcase Filter2
#yields (int 5266)
query textrel1 feed extend[l: length(.t)] sum[l]

#testcase Join1
#yields ((rel(tuple((no int)(no_s int))))((1 1)(2 3)))
query textrel1 feed textrel2 feed {s} product filter[.t contains .s_s] project[no, no_s] consume 

#teardown
close database;
delete database ftexttest;

